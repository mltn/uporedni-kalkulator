<style>
  .inputs {
	padding: 20px;
    display: grid;
	justify-content: space-evenly;
	align-content: space-evenly;
	grid-template-rows: 1fr 1fr 1fr;
	grid-template-columns: 1fr 1fr;
  }
  input {
    text-align: right;
  }
  div.options {
    display: flex;
    justify-content: space-around;
	flex-wrap: wrap;
  }
  div.option-block {
    width: 400px;
	border: 1px dashed black;
	text-align: center;
	margin-bottom: 15px;
  }
  div.field-block {
    margin-bottom: 20px;
  }
  div.label-input {
    width: 350px;
    text-align: right;
  }
  div.label-input input {
	margin: 2px 10px;
  }
  .inputs .label-input {
    width: 500px;
  }
  h4 {
	margin: 5px auto;
  }
</style>
<div class="inputs">
  <div class="label-input">
    <label>Bruto</label>
    <input type="money" id="bruto" value="60000"/>
  </div>
  <div class="label-input">
    <label>Normirani trošak (samo za fizička lica)</label>
    <input type="text" id="normirani-trosak" value="20"/>
  </div>
  <div class="label-input">
    <label>Neoporezivi deo za fizičko lice (kada bi postojao)</label>
    <input type="text" id="neoporezivi-deo" value="0"/>
  </div>
  <div class="label-input">
    <label>Ostali troškovi (samo za knjigaše)</label>
    <input type="text" id="ostali-troskovi" value="5000"/>
  </div>
  <div class="label-input">
    <label>Paušal osnovica (samo za paušalce)</label>
    <input type="text" id="pausal-osnovica" value="40000"/>
  </div>
</div>
<div class="options">
  <div class="option-block" id="fizicko-lice"></div>
  <div class="option-block" id="pausalac"></div>
  <div class="option-block" id="knjigas"></div>
</div>
<script>
  
  const defaults  = {
    teretZaposlenog: {
      pio: 14,
      zdravstveno: 5.15,
      nezaposlenost: 0.75,
      porez: 10,
    },
	teretPoslodavca: {
      pio: 11.5,
      zdravstveno: 5.15,
      nezaposlenost: 0,
      porez: 0,
    }
  };

  window.addEventListener('DOMContentLoaded', () => {
    const brutoElement = document.getElementById('bruto');
    const normiraniTrosakElement = document.getElementById('normirani-trosak');
    const neoporeziviDeoElement = document.getElementById('neoporezivi-deo');
	const ostaliTroskoviElement = document.getElementById('ostali-troskovi');
	const pausalOsnovicaElement = document.getElementById('pausal-osnovica');
    let bruto, normiraniTrosak, neoporeziviDeo, ostaliTroskovi, pausalOsnovica;
	const updateState = () => {
		bruto = brutoElement.value;
		normiraniTrosak = normiraniTrosakElement.value;
		neoporeziviDeo = neoporeziviDeoElement.value;
		ostaliTroskovi = ostaliTroskoviElement.value;
		pausalOsnovica = pausalOsnovicaElement.value;
		renderAll();
	};
	
    [brutoElement, normiraniTrosakElement, neoporeziviDeoElement, ostaliTroskoviElement, pausalOsnovicaElement].forEach(element => {
		element.addEventListener('change', updateState)
	});
	const createDefaultPidObj = () => ({
		teretZaposlenog: {...defaults.teretZaposlenog},
		teretPoslodavca: {...defaults.teretPoslodavca},
	});
	const format = x => Math.round(x * 100) / 100;
	const procenatBruto = x => Math.round(x * 10000 / bruto) / 100;
    const renderAll = () => {
	  const fizickoLiceElement = document.getElementById('fizicko-lice');
      const fizickoLice = createDefaultPidObj();
	  fizickoLice.title = 'Fizičko lice - ugovor o delu';
      fizickoLice.osnovica = bruto - neoporeziviDeo - (bruto - neoporeziviDeo) * normiraniTrosak / 100;
      fizickoLice.teretZaposlenog.nezaposlenost = 0;
	  fizickoLice.ostaliTroskovi = 0;
      fizickoLice.teretZaposlenog.porez = 20;
	  
	  const pausalElement = document.getElementById('pausalac');
      const pausal = createDefaultPidObj();
	  pausal.title = 'Paušalac';
      pausal.osnovica = pausalOsnovica;
	  pausal.ostaliTroskovi = 0;
	  
	  const knjigasElement = document.getElementById('knjigas');
      const knjigas = createDefaultPidObj();
	  knjigas.title = 'Knjigaš';
      knjigas.osnovica = 25801;
	  knjigas.ostaliTroskovi = ostaliTroskovi;
	  knjigas.placaPorezNaDohodakGradjana = true;
	  
	  render(fizickoLice, fizickoLiceElement);
	  render(pausal, pausalElement);
	  render(knjigas, knjigasElement);
    };
	const render = (pidObj, domElement) => {
		pidObj.teretZaposlenog.procenatOsnovice = pidObj.teretZaposlenog.pio +
			pidObj.teretZaposlenog.zdravstveno +
			pidObj.teretZaposlenog.porez + 
			pidObj.teretZaposlenog.nezaposlenost;
		pidObj.teretZaposlenog.ukupno = format(pidObj.osnovica * pidObj.teretZaposlenog.procenatOsnovice / 100);
		pidObj.teretPoslodavca.procenatOsnovice = pidObj.teretPoslodavca.zdravstveno +
			pidObj.teretPoslodavca.pio;
		pidObj.teretPoslodavca.ukupno = format(pidObj.osnovica * pidObj.teretPoslodavca.procenatOsnovice / 100);
		
		if (pidObj.placaPorezNaDohodakGradjana) {				
			const osnovicaZaPorezNaDohodakGradjana = (bruto -
				(pidObj.teretZaposlenog.ukupno + pidObj.teretPoslodavca.ukupno + pidObj.ostaliTroskovi + 15420));
			pidObj.porezNaDohodakGradjana = format(osnovicaZaPorezNaDohodakGradjana * 10 / 100);
		} else {
			pidObj.porezNaDohodakGradjana = 0;
		}
		
		pidObj.ukupnoPid = format(pidObj.teretZaposlenog.ukupno + pidObj.teretPoslodavca.ukupno + pidObj.porezNaDohodakGradjana);
		pidObj.neto = format(bruto - pidObj.ukupnoPid - pidObj.ostaliTroskovi);
		domElement.innerHTML = `
			<div class="field-block">
			  <h3>${pidObj.title}</h3>
			  <div class="label-input">
				<label>Osnovica</label>
				<input type="text" class="osnovica"
					   value="${pidObj.osnovica}"
					   disabled />
			  </div>
			</div>
			<div class="field-block">
			  <h4>Na teret zaposlenog</h4>
			  <div class="label-input">
				<label>PIO (${pidObj.teretZaposlenog.pio}%)</label>
				<input type="text" class="zaposleni-pio"
					   value="${format(pidObj.osnovica * pidObj.teretZaposlenog.pio / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>Zdravstveno (${pidObj.teretZaposlenog.zdravstveno}%)</label>
				<input type="text" class="zaposleni-zdravstveno"
					   value="${format(pidObj.osnovica * pidObj.teretZaposlenog.zdravstveno / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>Porez (${pidObj.teretZaposlenog.porez}%)</label>
				<input type="text"
					   value="${format(pidObj.osnovica * pidObj.teretZaposlenog.porez / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>Nezaposlenost (${pidObj.teretZaposlenog.nezaposlenost}%)</label>
				<input type="text" class="zaposleni-nezaposlentost"
					   value="${format(pidObj.osnovica * pidObj.teretZaposlenog.nezaposlenost / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label><b>Ukupno</b></label>
				<input type="text"
					   value="${pidObj.teretZaposlenog.ukupno}"
					   disabled />	
			  </div>
			  <div class="label-input">
				<label><b>%</b></label>
				<input type="text"
					   value="${procenatBruto(pidObj.teretZaposlenog.ukupno)}"
					   disabled />
				</div>
			</div>
			<div class="field-block">
			  <h4>Na teret poslodavca</h4>
			  <div class="label-input">
				<label>PIO (${pidObj.teretPoslodavca.pio}%)</label>
				<input type="text"
					   value="${format(pidObj.osnovica * pidObj.teretPoslodavca.pio / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>Zdravstveno (${pidObj.teretPoslodavca.zdravstveno}%)</label>
				<input type="text"
					   value="${format(pidObj.osnovica * pidObj.teretPoslodavca.zdravstveno / 100)}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label><b>Ukupno</b></label>
				<input type="text"
					   value="${pidObj.teretPoslodavca.ukupno}"
					   disabled />	
			  </div>
			  <div class="label-input">
				<label><b>%</b></label>
				<input type="text"
					   value="${procenatBruto(pidObj.teretZaposlenog.ukupno)}"
					   disabled />
			  </div>
			</div>
			<div class="field-block">
			  <h4>Porez na dohodak građana</h4>
			  <div class="label-input">
				<label>Porez na doh</label>
				<input type="text"
					   value="${pidObj.porezNaDohodakGradjana}"
					   disabled />
			  </div>
			</div>
			<div class="field-block">
			  <h4>Ukupno</h4>
			  <div class="label-input">
				<label>Ostali troškovi</label>
				<input type="text"
					   value="${pidObj.ostaliTroskovi}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>UKUPNO PID</label>
				<input type="text"
					   value="${pidObj.ukupnoPid}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>NETO</label>
				<input type="text"
					   value="${pidObj.neto}"
					   disabled />
			  </div>
			  <div class="label-input">
				<label>%</label>
				<input type="text"
					   value="${procenatBruto(pidObj.ukupnoPid + pidObj.ostaliTroskovi)}"
					   disabled />
			  </div>
			</div>
		`;
	};
	updateState();
  });
</script>
